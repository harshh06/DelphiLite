# DelphiLite Interpreter

A Delphi/Object Pascal interpreter built with Java and ANTLR4, supporting object-oriented features including classes, constructors/destructors, encapsulation, inheritance, and interfaces.

## Features Implemented

- [x] Classes and Objects (`type TMyClass = class ... end;`)
- [x] Constructors and Destructors (`constructor Create; destructor Destroy;`)
- [x] Encapsulation (private/public/protected visibility enforcement)
- [x] Method Calls with Parameters (`obj.Method(arg1, arg2)`)
- [x] Field Access (`obj.Field`)
- [x] Variable Declarations and Assignments
- [x] Arithmetic Expressions (`+`, `-`, `*`, `/`)
- [x] String Concatenation (`'Hello ' + 'World'`)
- [x] I/O (`writeln`, `readln`)
- [x] **Bonus:** Inheritance (`TChild = class(TParent)`)
- [x] **Bonus:** Interfaces (`IMyInterface = interface ... end;`)

## Project Structure

```text
DelphiLite/
├── grammar/
│   └── delphi.g4                    # ANTLR4 grammar (source of truth)
├── src/
│   ├── grammar/                     # AUTO-GENERATED by ANTLR (do not edit)
│   └── interpreter/
│       ├── DelphiInterpreter.java   # Main visitor-based interpreter
│       ├── Environment.java         # Scoped symbol table
│       ├── ClassDefinition.java     # Class metadata storage
│       ├── ObjectInstance.java      # Runtime object instances
│       └── InterfaceDefinition.java # Interface metadata and validation
├── tests/
│   ├── test1.pas                    # Basic class
│   ├── test2.pas                    # Multiple objects (independent state)
│   ├── test3.pas                    # Encapsulation violation (expected error)
│   ├── test4.pas                    # Constructor with parameters
│   ├── test5.pas                    # I/O integration (readln + class)
│   ├── test6.pas                    # Inheritance (bonus)
│   └── test7.pas                    # Interfaces (bonus)
├── lib/
│   └── antlr-4.13.2-complete.jar
├── README.md
└── .gitignore
```

## Prerequisites

- **Java 11+** — check with `java -version`
- **ANTLR 4.13.2 Complete JAR** — included in `lib/` folder

## Build Instructions

Run all commands from the project root (`DelphiLite/`).

### Step 1: Generate Parser from Grammar

```bash
java -jar lib/antlr-4.13.2-complete.jar -package grammar -visitor grammar/delphi.g4 -o src
```

### Step 2: Compile All Java Files

```bash
javac -cp lib/antlr-4.13.2-complete.jar src/grammar/*.java src/interpreter/*.java
```

## Run Instructions

```bash
java -cp "src:lib/antlr-4.13.2-complete.jar" interpreter.DelphiInterpreter tests/test1.pas
```

On Windows, use `;` instead of `:` in the classpath:

```bash
java -cp "src;lib/antlr-4.13.2-complete.jar" interpreter.DelphiInterpreter tests/test1.pas
```

## Test Cases

| File       | What It Tests                        | Expected Output                                    |
|------------|--------------------------------------|----------------------------------------------------|
| test1.pas  | Basic class, constructor, methods    | `Counter created`, `3`, `Counter destroyed`        |
| test2.pas  | Multiple independent objects         | `5`, `1`                                           |
| test3.pas  | Private field access (should error)  | `42`, then RuntimeException for private access     |
| test4.pas  | Constructor with parameters          | `Hello Alice`, `25`                                |
| test5.pas  | readln + writeln with class          | Reads integer from stdin, prints it back           |
| test6.pas  | Inheritance (bonus)                  | `Animal created` x2, names + overridden sounds     |
| test7.pas  | Interfaces (bonus)                   | `10`, `20`, `30`                                   |

### Run All Tests (except test3 which errors, and test5 which needs input)

```bash
for f in tests/test1.pas tests/test2.pas tests/test4.pas tests/test6.pas tests/test7.pas; do
  echo "=== Running $f ==="
  java -cp "src:lib/antlr-4.13.2-complete.jar" interpreter.DelphiInterpreter "$f"
  echo ""
done
```

### Run test5 (interactive input)

```bash
echo "42" | java -cp "src:lib/antlr-4.13.2-complete.jar" interpreter.DelphiInterpreter tests/test5.pas
```

### Run test3 (encapsulation violation — expect error)

```bash
java -cp "src:lib/antlr-4.13.2-complete.jar" interpreter.DelphiInterpreter tests/test3.pas
```

## Known Limitations

- No `if/then/else` or `while/do` control flow
- No array support
- `readln` only reads integers
- Protected visibility is enforced the same as private (no subclass exception)
- No `inherited` keyword support
- Single-file programs only (no `uses` clause)
